# InsightFlow - 开源项目 MVP 功能文档 (v3.0)

## 0. 一句话介绍

- **这是什么？**
  一个以“RSS + PDF”为核心的智能阅读工作台。它不仅仅是阅读器，更是一个**“多文档研读环境”**。
- **解决谁的什么小问题？**
  解决知识工作者在阅读高价值文章时，难以快速调用本地知识库或网络信息进行对比，且缺乏高效手段将**“当前阅读文章 + 关联资料 + 随手笔记”**快速熔炼成一份结构化、可追溯的**“Takeaway（研读报告）”**的问题。

## 1. MVP 要做的核心价值

- **MVP 验证的核心假设：**
  **“持久化暂存区 + 混合源 RAG + 锚点综述”** 的工作流，能否让用户在不切换软件的情况下，完成从“碎片阅读”到“结构化笔记”的闭环。
- **用户用完的“爽点/结果”是：**
  我看了一篇新文章，顺藤摸瓜看了 AI 推荐的旧文和网络新资讯，选中它们，一键生成了一份全局编号为 `#TK-001` 的研读报告。以后我再读这些文章时，能看到它们属于 `#TK-001`，并且点击报告里的结论，能直接跳回原文的高亮段落。

## 2. 目标用户与使用场景

- **目标用户：**
  需要深度阅读并产出观点的**技术专家**、**行业分析师**、**研究生**。
- **核心场景（The "Deep Dive" Workflow）：**
  1.  **触发**：阅读 RSS 推送的技术博客（文章 A）。
  2.  **混合检索**：开启“联网搜索”。询问 AI 某概念，AI 返回了本地 PDF B 的引用，以及最新的网页新闻 C。
  3.  **持久暂存**：将 A、B、C 全部加入“暂存区”。第二天回来，它们还在。
  4.  **选择性产出**：在暂存区勾选 A 和 B（觉得 C 质量不高），点击“生成 Takeaway”。
  5.  **双向回溯**：生成了笔记 `#TK-1024`。一周后，用户打开 PDF B，发现信息栏提示“关联笔记：#TK-1024”，点击即可复习当时的总结。

## 3. 功能范围 (Scope)

- **必做（MVP 核心）：**
  - **F1 (混合源 RAG)**：支持对“本地知识库”和“外部网页搜索”的双重检索，并明确标识来源。
  - **F2 (持久化工作台)**：暂存区与用户账号/本地库绑定，支持增删改查，支持对暂存文章进行“勾选”以决定是否纳入总结。
  - **F3 (锚点综述)**：生成的 Takeaway 笔记包含精确到段落的引用锚点（Anchor Links）。
  - **F4 (双向关联)**：文章页需展示“关联的 Takeaway”列表。
- **暂不做：**
  - **N1**：复杂的 UI 拖拽自定义布局（保持默认布局即可）。
  - **N2**：多模态支持。
  - **N3**：社交分享功能。

## 4. 核心用户流程 (User Flow)

1.  **阅读**：打开文章《DeepSeek 架构解析》。
2.  **检索**：在 AI 侧边栏开启“Web Search”开关，提问“MoE 路由机制对比”。
3.  **结果**：AI 回复：“本地库发现《Switch Transformer》[Local]；网络搜索发现《GShard 论文》[Web]。”
4.  **收集**：用户将当前文章、以及 AI 推荐的两篇文章全部 **“加入暂存”**。
5.  **整理**：进入暂存区，发现里面还有上周存的一篇无关文章，**取消勾选**该旧文，仅**勾选**刚才的三篇。
6.  **生成**：点击“生成 Takeaway”。
7.  **存档**：系统数据库自增 ID 生成笔记 `#TK-0001`。
8.  **验证**：用户点击笔记中的结论引用 `[1]`，阅读器自动打开《Switch Transformer》并**滚动高亮**对应段落。

## 5. 功能清单 (Feature Specs)

### 模块 A：数据源与处理 (Input & Processing)

- **A1 混合订阅与导入**：支持 RSS、PDF 拖拽、URL 粘贴。
- **A2 混合检索能力 (Hybrid Search)**：
  - **开关**：提供“联网搜索”Toggle（需配置 Search API Key，如 Serper/Bing）。
  - **分类输出**：AI 回答时，必须将引用源分类标记为 `[知识库]` 或 `[网络]`。
- **A3 智能打标**：文章入库自动生成 Domain Tags。

### 模块 B：研读工作台 (The Workbench / Staging)

- **B1 持久化暂存区**：
  - **生命周期**：持久化存储（Database），不随会话关闭而清空。
  - **选择逻辑**：提供 Checkbox（复选框）。用户可以决定本次总结使用哪些素材。
  - **清理逻辑**：提供“移除选中”、“清空已读”等快捷操作。
- **B2 上下文感知**：
  - 阅读器能感知当前文章是否已存在于暂存区，状态实时同步（如显示“已暂存”状态）。

### 模块 C：智能产出 (The Synthesis)

- **C1 全局 ID 系统**：
  - **逻辑**：Takeaway ID 由数据库全局自增生成（如 `#TK-1001`），确保唯一性和可读性。
  - **双向关联**：
    - 笔记 -> 文章：笔记内包含文章链接。
    - 文章 -> 笔记：在文章详情/信息页，列出“此文章被包含在哪些 Takeaway 中”。
- **C2 锚点引用 (Anchor Linking)**：
  - **逻辑**：AI 生成总结时，需记录引用文字在原文中的 `quote` 或 `offset`。
  - **交互**：点击笔记里的引用角标，应用自动跳转到原文并**高亮**该段落。
- **C3 结构化 Prompt**：
  - 提示词需包含：“请区分知识库内容和网络搜索内容”、“请对冲突观点进行对比”。

## 6. Roadmap (Development & Evolution)

- **v1.0 (MVP Core)**:
  - **基础建设**：跑通 RSS 解析、PDF 文本提取、本地向量库存储。
  - **混合检索**：实现 AI Chat (RAG) + 联网搜索开关，输出带来源标记的回复。
  - **核心工作流**：实现左侧“持久化暂存区” (Staging) 的增删改查与勾选逻辑。
  - **产出闭环**：实现“生成 Takeaway”功能，包含全局自增 ID 和基础的锚点引用。

- **v1.1 (Management & Tuning)**:
  - **笔记库界面**：增加独立的“研读报告列表页”，支持按 ID/标签/关联文章搜索历史笔记。
  - **Prompt 自定义**：允许用户在设置中微调 Takeaway 的生成模板（例如：“偏好学术风格” vs “偏好通俗风格”）。
  - **双向关联展示**：在文章阅读页的信息面板中，列出“关联的 Takeaway”链接，实现反向回溯。

- **v1.2 (Flow & Speed - The Power User Update)**:
  - **键盘驱动 (Keyboard First)**：全键盘操作支持。`J/K` 切换文章列表，`I` 快速加入/移除暂存，`G` 呼出生成窗口。让双手不离键盘。
  - **阅读进度记忆**：PDF 和长文自动记住上次阅读位置，再次打开时自动跳转。
  - **手动导入优化**：支持粘贴 URL 自动爬取全文（解决 RSS 只有摘要的问题）。

- **v1.3 (Visual & Insight - The Intelligence Update)**:
  - **知识图谱可视化 (Knowledge Graph)**：在文章页展示一个迷你的关系网，可视化显示 “当前文章” 与 “暂存区其他文章” 及 “已生成笔记” 的引用连接关系。
  - **智能高亮预测 (Smart Highlight)**：当用户选中一句话，AI 预判用户意图，直接弹出 “寻找反义观点” 或 “寻找支持论据” 的快捷菜单，减少输入 Prompt 的时间。

- **v2.0 (Review & Long-term Value)**:
  - **回顾模式 (Spaced Repetition)**：基于生成的 Takeaway，设计一个 “每日回顾” 卡片界面，帮助用户定期复习之前的研读成果，对抗遗忘曲线。
  - **导出增强**：支持通过 API 将 Takeaway 同步到 Notion/Obsidian（如果用户有强烈需求）。

## X. 附录

### V3.0 prompt 

> 1. 我的想法是平衡。可以让AI对输出进行分类。比如1.以下文章来自您的知识库。2.以下来自网页搜索（取决于用户是否开启网页搜索功能）
> 2. 生命周期应该是和用户绑定，持久化的。但是我们可以提供选择按钮，可以清除掉一些未暂存的文章，对AI总结笔记也同理（也就是选中哪些，总结哪些，有删除功能）。至于你说的takeaway后，不需要立刻清空，由用户自主用全选按钮一键删除就可以了。
> 3. 这个TakeAway编号的本意是，用户将TakeAway记在了他的笔记软件，过几天他在阅读新文章，发现AI推荐了读过的文章且生成了笔记，就可以找到之前的笔记，然后再做修改（所以每篇文章，生成了笔记后，应该在文章的信息页有标记，用户也可以手动添加）。至于你说的AI生成结论旁边有锚点，是我没想到的功能，我认为可以加上去
> 4. mvp2.0版本有如下问题：
>    - 不应该设计UI相关的部分，比如`**UI 布局变革**：左侧栏分为上下两部分（或 Tab 切换），上部是**导航/Feed**，下部是**暂存区 (Staging)**。`
>    - 编号应是全局自增，而非AI生成，可以考虑用数据库记录？
>    - RoadMap可以再添加一些展望，你帮我想一想！应该是偏向用户体验方面的
