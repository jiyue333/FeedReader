# AnkiFlow MVP v1.0 任务分解

## M1 基础建设 ✅

### M1-01 项目初始化（前后端脚手架） ✅
- **描述**：初始化 Next.js + Tailwind + TS；FastAPI 项目结构与基础依赖。
- **前置依赖**：无
- **预估工时**：3h
- **实际完成**：2026-01-02
- **验收标准**：
  - ✅ 前端可启动并显示空白布局页（Next.js 16.1.1 + Tailwind v4）
  - ✅ 后端可启动并返回健康检查（FastAPI + uvicorn）

### M1-02 配置与环境管理 ✅
- **描述**：建立配置管理、`.env.example`、日志基础配置。
- **前置依赖**：M1-01
- **预估工时**：2h
- **实际完成**：2026-01-02
- **验收标准**：
  - ✅ 环境变量缺失时给出清晰错误（Pydantic Settings）
  - ✅ 关键配置项可在本地覆盖（支持根目录和 backend/ 目录 .env）

### M1-03 数据库初始化与迁移 ✅
- **描述**：建立基础表（users, documents, sources, document_chunks, embeddings, tags, document_tags, staging_items, takeaways, takeaway_sources, anchors, takeaway_refs），配置迁移工具。
- **前置依赖**：M1-01
- **预估工时**：4h
- **实际完成**：2026-01-02
- **验收标准**：
  - ✅ 迁移可在空库执行成功（Alembic v001）
  - ✅ 核心表结构与字段完整（12 张表，含枚举、索引、约束）

### M1-04 pgvector 启用与向量表 ✅
- **描述**：启用 pgvector 扩展并创建 embeddings/document_chunks 表。
- **前置依赖**：M1-03
- **预估工时**：3h
- **实际完成**：2026-01-02
- **验收标准**：
  - ✅ pgvector 扩展可正常使用（CREATE EXTENSION vector）
  - ✅ 向量表可写入与查询（HNSW 索引 + Vector(1536)）

### M1-05 后端 API 骨架与健康检查 ✅
- **描述**：搭建 FastAPI 路由结构、统一错误返回、健康检查接口。
- **前置依赖**：M1-01
- **预估工时**：2h
- **实际完成**：2026-01-02
- **验收标准**：
  - ✅ `/api/health` 返回成功
  - ✅ API 统一返回格式可复用（APIResponse + ErrorDetail）

### M1-06 前端基础布局框架 ✅
- **描述**：实现顶栏/左侧栏/中部内容/右侧栏的布局骨架。
- **前置依赖**：M1-01
- **预估工时**：3h
- **实际完成**：2026-01-02
- **验收标准**：
  - ✅ Dashboard 页面布局与 UI 规范一致（深色主题 #121212，主色 #38BDF8）
  - ✅ 右侧 AI 栏默认隐藏（点击顶栏 AI 按钮可切换）

## M2 数据源模块（RSS / PDF / URL） ✅

### M2-01 RSS 订阅管理 API ✅
- **描述**：新增/删除 RSS 源并保存配置。
- **前置依赖**：M1-03, M1-05
- **预估工时**：3h
- **实际完成**：2026-01-02
- **验收标准**：
  - ✅ 可创建与删除 RSS 源
  - ✅ 存在用户隔离

### M2-02 RSS 拉取与文章入库 ✅
- **描述**：拉取 RSS 条目并写入 documents 表。
- **前置依赖**：M2-01, M1-03
- **预估工时**：4h
- **实际完成**：2026-01-02
- **验收标准**：
  - ✅ 新条目可入库且去重（source-scoped）
  - ✅ 文章列表可查询

### M2-03 PDF 上传与文本解析 ✅
- **描述**：支持 PDF 上传并解析文本入库。
- **前置依赖**：M1-03, M1-05
- **预估工时**：4h
- **实际完成**：2026-01-02
- **验收标准**：
  - ✅ PDF 可上传并生成 document 记录
  - ✅ 文本可被检索（非空）

### M2-04 URL 导入与全文抓取 ✅
- **描述**：支持粘贴 URL 抓取全文并入库。
- **前置依赖**：M1-05, M1-03
- **预估工时**：4h
- **实际完成**：2026-01-02
- **验收标准**：
  - ✅ URL 可入库，正文可解析（trafilatura + BeautifulSoup fallback）
  - ✅ 失败时返回清晰错误

### M2-05 文档切分与向量化写入 ✅
- **描述**：对入库文档分段并写入向量表。
- **前置依赖**：M1-04, M2-02, M2-03, M2-04
- **预估工时**：4h
- **实际完成**：2026-01-02
- **验收标准**：
  - ✅ 每个文档产生分段记录（512 tokens, 50 overlap）
  - ✅ 向量可按文档检索（text-embedding-3-small, 1536 dim）

### M2-06 前端导入入口与列表展示 ⏳
- **描述**：实现 `+ Import` 模态与导入结果展示。
- **前置依赖**：M1-06, M2-01, M2-03, M2-04
- **预估工时**：3h
- **验收标准**：
  - ⏳ 可导入 RSS/PDF/URL (Backend ready, Frontend pending)
  - ⏳ 新文档出现在列表中

## M3 工作台模块（暂存区 + 混合检索 + 筛选）

### M3-00 FilterBox 筛选功能
- **描述**：实现文章列表的筛选功能，支持标签筛选、Unread/Starred/PDF Only 快捷过滤。
- **前置依赖**：M1-06, M2-06
- **预估工时**：3h
- **验收标准**：
  - 支持按标签筛选文章
  - Unread/Starred/PDF Only 快捷切换
  - 筛选状态可清除

### M3-01 暂存区 CRUD API
- **描述**：提供暂存区列表、加入、移除、勾选接口。
- **前置依赖**：M1-03, M1-05
- **预估工时**：3h
- **验收标准**：
  - 暂存条目可增删改查
  - 勾选状态持久化

### M3-02 暂存区 UI 与勾选交互
- **描述**：实现 Staging Dock 列表、勾选、移除、全选。
- **前置依赖**：M1-06, M3-01
- **预估工时**：3h
- **验收标准**：
  - 勾选状态与后端一致
  - 支持一键全选与移除

### M3-03 混合检索 API（本地 + 网络）
- **描述**：实现向量检索 + Search API 的合并返回。
- **前置依赖**：M1-04, M2-05
- **预估工时**：4h
- **验收标准**：
  - 返回结果含来源标识
  - 可通过开关禁用网络搜索

### M3-04 AI 侧边栏与流式响应
- **描述**：实现 AI Chat UI 与流式输出，并提供"联网搜索"开关入口。
- **前置依赖**：M1-06, M3-03
- **预估工时**：5h
- **验收标准**：
  - AI 回复按来源分类展示
  - 可在 UI 中切换是否启用网络搜索
  - 流式输出可中断/重试

### M3-05 阅读器页面与文章详情
- **描述**：实现 Reader Workbench 页面与文章详情渲染。
- **前置依赖**：M2-06, M3-01
- **预估工时**：4h
- **验收标准**：
  - 文章正文与元信息完整展示
  - 文章页显示“已暂存/未暂存”状态

### M3-06 引用来源标记渲染
- **描述**：实现 `[Local]` / `[Web]` 视觉胶囊展示。
- **前置依赖**：M3-04
- **预估工时**：2h
- **验收标准**：
  - 引用块带来源标记
  - 样式符合 UI 规范

## M4 产出模块（Takeaway + 锚点）

### M4-01 Takeaway 生成 API
- **描述**：基于勾选的暂存内容生成结构化笔记。
- **前置依赖**：M3-01, M3-03
- **预估工时**：4h
- **验收标准**：
  - 生成结果包含结构化标题与段落
  - 支持提示词区分本地/网络内容

### M4-02 Takeaway 全局 ID 与持久化
- **描述**：使用数据库自增 ID 生成 `#TK-xxxx` 并保存。
- **前置依赖**：M1-03, M4-01
- **预估工时**：2h
- **验收标准**：
  - Takeaway ID 全局唯一且可读
  - 列表查询返回 ID 与内容

### M4-03 锚点引用记录与跳转
- **描述**：保存引用 quote/offset，支持定位高亮。
- **前置依赖**：M2-05, M3-05, M4-01, M4-04
- **预估工时**：5h
- **验收标准**：
  - 点击引用可滚动到对应段落
  - 高亮动画触发且可重复

### M4-04 记忆熔炼页（Synthesis Modal）
- **描述**：实现 Takeaway 编辑弹窗与引用列表。
- **前置依赖**：M4-01, M1-06
- **预估工时**：4h
- **验收标准**：
  - 弹窗支持编辑与保存
  - 引用列表可跳转原文

### M4-05 双向关联展示
- **描述**：文章页显示关联 Takeaway，笔记内显示引用文章。
- **前置依赖**：M4-02, M3-05
- **预估工时**：3h
- **验收标准**：
  - 文章页展示关联列表
  - 关联点击可打开对应页面

### M4-06 MVP 全流程验收
- **描述**：按核心流程执行一次完整验证并记录问题。
- **前置依赖**：M4-05
- **预估工时**：2h
- **验收标准**：
  - RSS/URL/PDF 任一来源可生成 Takeaway
  - 引用跳转与高亮可用
